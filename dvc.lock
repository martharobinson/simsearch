schema: '2.0'
stages:
  embed_baseline@gallery:
    cmd: python scripts/embed_with_clip.py --data-root "data/In-shop Clothes 
      Retrieval Benchmark" --split gallery --batch-size 32 --output 
      data/embeddings/baseline/gallery.csv
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/In-shop Clothes Retrieval Benchmark/Img/
      hash: md5
      md5: d5d4c658abd19747fff86181d4ab98fa.dir
      size: 843003820
      nfiles: 52716
    - path: scripts/embed_with_clip.py
      hash: md5
      md5: 83a20b0f5552c45bbef470a61692253a
      size: 2192
    outs:
    - path: data/embeddings/baseline/gallery.csv
      hash: md5
      md5: 8dd24544cac822912fa37110a5634a2e
      size: 74202475
  embed_baseline@query:
    cmd: python scripts/embed_with_clip.py --data-root "data/In-shop Clothes 
      Retrieval Benchmark" --split query --batch-size 32 --output 
      data/embeddings/baseline/query.csv
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/In-shop Clothes Retrieval Benchmark/Img/
      hash: md5
      md5: d5d4c658abd19747fff86181d4ab98fa.dir
      size: 843003820
      nfiles: 52716
    - path: scripts/embed_with_clip.py
      hash: md5
      md5: 83a20b0f5552c45bbef470a61692253a
      size: 2192
    outs:
    - path: data/embeddings/baseline/query.csv
      hash: md5
      md5: cad00b562c2fb94775158ab671bca123
      size: 83668516
  evaluate@baseline:
    cmd: python scripts/evaluate_similiarity_search.py --eval-file "data/In-shop
      Clothes Retrieval Benchmark/Eval/list_eval_partition.txt" 
      --gallery-embeddings-csv data/embeddings/baseline/gallery.csv 
      --query-embeddings-csv data/embeddings/baseline/query.csv --output-file 
      data/results/baseline_eval.csv
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/embeddings/baseline/gallery.csv
      hash: md5
      md5: 8dd24544cac822912fa37110a5634a2e
      size: 74202475
    - path: data/embeddings/baseline/query.csv
      hash: md5
      md5: cad00b562c2fb94775158ab671bca123
      size: 83668516
    - path: scripts/evaluate_similiarity_search.py
      hash: md5
      md5: 9bdf1a2e1598334d3902a74dc7efac64
      size: 3115
    outs:
    - path: data/results/baseline_eval.csv
      hash: md5
      md5: 75fef909e49283614e83af80cceaffa9
      size: 106
  train_lora_clip:
    cmd: python scripts/train_clip_lora_lightning.py
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/In-shop Clothes Retrieval Benchmark/Img/
      hash: md5
      md5: d5d4c658abd19747fff86181d4ab98fa.dir
      size: 843003820
      nfiles: 52716
    - path: scripts/train_clip_lora_lightning.py
      hash: md5
      md5: 7898d123b8e12b6ba3e4225e53317f21
      size: 10666
    outs:
    - path: models/clip_vit_lora_lightning/final.ckpt
      hash: md5
      md5: 2b94a30b658fcbecd3f1a1802f3f239e
      size: 353536239
    - path: models/clip_vit_lora_lightning/final_lora
      hash: md5
      md5: 7cf565192b386095c94bffae1c48b2e8.dir
      size: 1192709
      nfiles: 3
  embed_with_lora_clip@gallery:
    cmd: python scripts/embed_with_lora_clip.py --data-root "data/In-shop 
      Clothes Retrieval Benchmark" --split gallery --batch-size 32 --output 
      data/embeddings/lora/gallery.csv --lora-dir 
      models/clip_vit_lora_lightning/final_lora
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/In-shop Clothes Retrieval Benchmark/Img/
      hash: md5
      md5: d5d4c658abd19747fff86181d4ab98fa.dir
      size: 843003820
      nfiles: 52716
    - path: models/clip_vit_lora_lightning/final_lora
      hash: md5
      md5: 7cf565192b386095c94bffae1c48b2e8.dir
      size: 1192709
      nfiles: 3
    - path: scripts/embed_with_lora_clip.py
      hash: md5
      md5: a20ef448ee297815183042da0dc078d3
      size: 2526
    outs:
    - path: data/embeddings/lora/gallery.csv
      hash: md5
      md5: c8cfb72464524f6a315d518f13e4b90c
      size: 105833087
  embed_with_lora_clip@query:
    cmd: python scripts/embed_with_lora_clip.py --data-root "data/In-shop 
      Clothes Retrieval Benchmark" --split query --batch-size 32 --output 
      data/embeddings/lora/query.csv --lora-dir 
      models/clip_vit_lora_lightning/final_lora
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/In-shop Clothes Retrieval Benchmark/Img/
      hash: md5
      md5: d5d4c658abd19747fff86181d4ab98fa.dir
      size: 843003820
      nfiles: 52716
    - path: models/clip_vit_lora_lightning/final_lora
      hash: md5
      md5: 7cf565192b386095c94bffae1c48b2e8.dir
      size: 1192709
      nfiles: 3
    - path: scripts/embed_with_lora_clip.py
      hash: md5
      md5: a20ef448ee297815183042da0dc078d3
      size: 2526
    outs:
    - path: data/embeddings/lora/query.csv
      hash: md5
      md5: fe8e97d1f29b8e782928a8d6a8e3219c
      size: 119329559
  evaluate@lora:
    cmd: python scripts/evaluate_similiarity_search.py --eval-file "data/In-shop
      Clothes Retrieval Benchmark/Eval/list_eval_partition.txt" 
      --gallery-embeddings-csv data/embeddings/lora/gallery.csv 
      --query-embeddings-csv data/embeddings/lora/query.csv --output-file 
      data/results/lora_eval.csv
    deps:
    - path: data/In-shop Clothes Retrieval 
        Benchmark/Eval/list_eval_partition.txt
      hash: md5
      md5: 5ef30d675b58d5b7245589fa41c2cd74
      size: 5007683
    - path: data/embeddings/lora/gallery.csv
      hash: md5
      md5: c8cfb72464524f6a315d518f13e4b90c
      size: 105833087
    - path: data/embeddings/lora/query.csv
      hash: md5
      md5: fe8e97d1f29b8e782928a8d6a8e3219c
      size: 119329559
    - path: scripts/evaluate_similiarity_search.py
      hash: md5
      md5: 9bdf1a2e1598334d3902a74dc7efac64
      size: 3115
    outs:
    - path: data/results/lora_eval.csv
      hash: md5
      md5: fd9edd8f1bc5053708004edd0ecf3821
      size: 106
